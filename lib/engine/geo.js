/**
 * 简化版地理位置查询服务
 * 包含主要城市坐标，未知城市默认返回北京坐标
 */

// 主要城市坐标数据
const CITY_DATA = {
  // 直辖市
  "北京": { lat: 39.9042, lng: 116.4074 },
  "北京市": { lat: 39.9042, lng: 116.4074 },
  "上海": { lat: 31.2304, lng: 121.4737 },
  "上海市": { lat: 31.2304, lng: 121.4737 },
  "天津": { lat: 39.0842, lng: 117.2008 },
  "天津市": { lat: 39.0842, lng: 117.2008 },
  "重庆": { lat: 29.5630, lng: 106.5516 },
  "重庆市": { lat: 29.5630, lng: 106.5516 },

  // 省会城市
  "广州": { lat: 23.1291, lng: 113.2644 },
  "广州市": { lat: 23.1291, lng: 113.2644 },
  "深圳": { lat: 22.5431, lng: 114.0579 },
  "深圳市": { lat: 22.5431, lng: 114.0579 },
  "杭州": { lat: 30.2741, lng: 120.1551 },
  "杭州市": { lat: 30.2741, lng: 120.1551 },
  "南京": { lat: 32.0603, lng: 118.7969 },
  "南京市": { lat: 32.0603, lng: 118.7969 },
  "成都": { lat: 30.6598, lng: 104.0633 },
  "成都市": { lat: 30.6598, lng: 104.0633 },
  "武汉": { lat: 30.5928, lng: 114.3055 },
  "武汉市": { lat: 30.5928, lng: 114.3055 },
  "西安": { lat: 34.3416, lng: 108.9398 },
  "西安市": { lat: 34.3416, lng: 108.9398 },
  "长沙": { lat: 28.2282, lng: 112.9388 },
  "长沙市": { lat: 28.2282, lng: 112.9388 },
  "郑州": { lat: 34.7466, lng: 113.6253 },
  "郑州市": { lat: 34.7466, lng: 113.6253 },
  "济南": { lat: 36.6512, lng: 117.1201 },
  "济南市": { lat: 36.6512, lng: 117.1201 },
  "青岛": { lat: 36.0671, lng: 120.3826 },
  "青岛市": { lat: 36.0671, lng: 120.3826 },
  "沈阳": { lat: 41.8057, lng: 123.4315 },
  "沈阳市": { lat: 41.8057, lng: 123.4315 },
  "大连": { lat: 38.9140, lng: 121.6147 },
  "大连市": { lat: 38.9140, lng: 121.6147 },
  "哈尔滨": { lat: 45.8038, lng: 126.5349 },
  "哈尔滨市": { lat: 45.8038, lng: 126.5349 },
  "长春": { lat: 43.8171, lng: 125.3235 },
  "长春市": { lat: 43.8171, lng: 125.3235 },
  "石家庄": { lat: 38.0428, lng: 114.5149 },
  "石家庄市": { lat: 38.0428, lng: 114.5149 },
  "太原": { lat: 37.8706, lng: 112.5489 },
  "太原市": { lat: 37.8706, lng: 112.5489 },
  "合肥": { lat: 31.8206, lng: 117.2272 },
  "合肥市": { lat: 31.8206, lng: 117.2272 },
  "福州": { lat: 26.0745, lng: 119.2965 },
  "福州市": { lat: 26.0745, lng: 119.2965 },
  "厦门": { lat: 24.4798, lng: 118.0819 },
  "厦门市": { lat: 24.4798, lng: 118.0819 },
  "南昌": { lat: 28.6820, lng: 115.8581 },
  "南昌市": { lat: 28.6820, lng: 115.8581 },
  "昆明": { lat: 25.0389, lng: 102.7183 },
  "昆明市": { lat: 25.0389, lng: 102.7183 },
  "贵阳": { lat: 26.6470, lng: 106.6302 },
  "贵阳市": { lat: 26.6470, lng: 106.6302 },
  "南宁": { lat: 22.8170, lng: 108.3669 },
  "南宁市": { lat: 22.8170, lng: 108.3669 },
  "海口": { lat: 20.0444, lng: 110.1989 },
  "海口市": { lat: 20.0444, lng: 110.1989 },
  "兰州": { lat: 36.0611, lng: 103.8343 },
  "兰州市": { lat: 36.0611, lng: 103.8343 },
  "西宁": { lat: 36.6171, lng: 101.7782 },
  "西宁市": { lat: 36.6171, lng: 101.7782 },
  "银川": { lat: 38.5026, lng: 106.2309 },
  "银川市": { lat: 38.5026, lng: 106.2309 },
  "乌鲁木齐": { lat: 43.8256, lng: 87.6168 },
  "乌鲁木齐市": { lat: 43.8256, lng: 87.6168 },
  "拉萨": { lat: 29.6625, lng: 91.1146 },
  "拉萨市": { lat: 29.6625, lng: 91.1146 },
  "呼和浩特": { lat: 40.8414, lng: 111.7519 },
  "呼和浩特市": { lat: 40.8414, lng: 111.7519 },

  // 其他主要城市
  "苏州": { lat: 31.2989, lng: 120.5853 },
  "苏州市": { lat: 31.2989, lng: 120.5853 },
  "无锡": { lat: 31.4912, lng: 120.3124 },
  "无锡市": { lat: 31.4912, lng: 120.3124 },
  "宁波": { lat: 29.8683, lng: 121.5440 },
  "宁波市": { lat: 29.8683, lng: 121.5440 },
  "温州": { lat: 27.9943, lng: 120.6994 },
  "温州市": { lat: 27.9943, lng: 120.6994 },
  "东莞": { lat: 23.0209, lng: 113.7518 },
  "东莞市": { lat: 23.0209, lng: 113.7518 },
  "佛山": { lat: 23.0218, lng: 113.1219 },
  "佛山市": { lat: 23.0218, lng: 113.1219 },
  "珠海": { lat: 22.2769, lng: 113.5678 },
  "珠海市": { lat: 22.2769, lng: 113.5678 },
  "常州": { lat: 31.7725, lng: 119.9462 },
  "常州市": { lat: 31.7725, lng: 119.9462 },
  "烟台": { lat: 37.4638, lng: 121.4475 },
  "烟台市": { lat: 37.4638, lng: 121.4475 },
  "潍坊": { lat: 36.7070, lng: 119.1615 },
  "潍坊市": { lat: 36.7070, lng: 119.1615 },
  "绍兴": { lat: 30.0023, lng: 120.5822 },
  "绍兴市": { lat: 30.0023, lng: 120.5822 },
  "嘉兴": { lat: 30.7467, lng: 120.7507 },
  "嘉兴市": { lat: 30.7467, lng: 120.7507 },
  "金华": { lat: 29.1028, lng: 119.6472 },
  "金华市": { lat: 29.1028, lng: 119.6472 },
  "台州": { lat: 28.6568, lng: 121.4200 },
  "台州市": { lat: 28.6568, lng: 121.4200 },
  "徐州": { lat: 34.2619, lng: 117.2848 },
  "徐州市": { lat: 34.2619, lng: 117.2848 },
  "南通": { lat: 32.0085, lng: 120.8647 },
  "南通市": { lat: 32.0085, lng: 120.8647 },
  "扬州": { lat: 32.3932, lng: 119.4217 },
  "扬州市": { lat: 32.3932, lng: 119.4217 },
  "洛阳": { lat: 34.6197, lng: 112.4540 },
  "洛阳市": { lat: 34.6197, lng: 112.4540 },
  "开封": { lat: 34.7971, lng: 114.3075 },
  "开封市": { lat: 34.7971, lng: 114.3075 },
  "惠州": { lat: 23.1115, lng: 114.4152 },
  "惠州市": { lat: 23.1115, lng: 114.4152 },
  "中山": { lat: 22.5177, lng: 113.3927 },
  "中山市": { lat: 22.5177, lng: 113.3927 },
  "汕头": { lat: 23.3547, lng: 116.6810 },
  "汕头市": { lat: 23.3547, lng: 116.6810 },
  "湛江": { lat: 21.2707, lng: 110.3594 },
  "湛江市": { lat: 21.2707, lng: 110.3594 },

  // 港澳台
  "香港": { lat: 22.3193, lng: 114.1694 },
  "澳门": { lat: 22.1987, lng: 113.5439 },
  "台北": { lat: 25.0330, lng: 121.5654 },
  "台北市": { lat: 25.0330, lng: 121.5654 },
  "台中": { lat: 24.1477, lng: 120.6736 },
  "台中市": { lat: 24.1477, lng: 120.6736 },
  "高雄": { lat: 22.6273, lng: 120.3014 },
  "高雄市": { lat: 22.6273, lng: 120.3014 },

  // 海外主要城市
  "新加坡": { lat: 1.3521, lng: 103.8198 },
  "吉隆坡": { lat: 3.1390, lng: 101.6869 },
  "曼谷": { lat: 13.7563, lng: 100.5018 },
  "东京": { lat: 35.6762, lng: 139.6503 },
  "首尔": { lat: 37.5665, lng: 126.9780 },
  "纽约": { lat: 40.7128, lng: -74.0060 },
  "洛杉矶": { lat: 34.0522, lng: -118.2437 },
  "旧金山": { lat: 37.7749, lng: -122.4194 },
  "悉尼": { lat: -33.8688, lng: 151.2093 },
  "墨尔本": { lat: -37.8136, lng: 144.9631 },
  "伦敦": { lat: 51.5074, lng: -0.1278 },
  "巴黎": { lat: 48.8566, lng: 2.3522 },
  "温哥华": { lat: 49.2827, lng: -123.1207 },
  "多伦多": { lat: 43.6532, lng: -79.3832 }
};

// 历史地名别名
const ALIASES = {
  "燕京": "北京",
  "金陵": "南京",
  "临安": "杭州",
  "长安": "西安",
  "奉天": "沈阳",
  "汴京": "开封",
  "汴梁": "开封",
  "羊城": "广州",
  "花城": "广州",
  "鹏城": "深圳",
  "泉城": "济南",
  "山城": "重庆",
  "春城": "昆明",
  "冰城": "哈尔滨",
  "江城": "武汉",
  "星城": "长沙",
  "狮城": "新加坡",
  "三藩市": "旧金山"
};

// 默认坐标（北京）
const DEFAULT_COORDS = { lat: 39.9042, lng: 116.4074 };

/**
 * 查询城市坐标
 * @param {string} city - 城市名称
 * @returns {Object} { success, data: { latitude, longitude }, error }
 */
export function lookupCity(city) {
  if (!city || typeof city !== 'string') {
    return {
      success: false,
      error: '城市参数无效',
      data: null
    };
  }

  // 标准化输入
  const normalized = city.trim().replace(/市$/, '').replace(/省$/, '');

  // 检查别名
  const aliasKey = ALIASES[normalized];
  if (aliasKey) {
    const coords = CITY_DATA[aliasKey] || CITY_DATA[aliasKey + '市'];
    if (coords) {
      return {
        success: true,
        data: {
          latitude: coords.lat,
          longitude: coords.lng,
          city: aliasKey
        }
      };
    }
  }

  // 直接查找
  let coords = CITY_DATA[normalized] || CITY_DATA[normalized + '市'] || CITY_DATA[city];

  if (coords) {
    return {
      success: true,
      data: {
        latitude: coords.lat,
        longitude: coords.lng,
        city: normalized
      }
    };
  }

  // 模糊匹配：检查是否包含某个城市名
  for (const [name, coord] of Object.entries(CITY_DATA)) {
    if (city.includes(name.replace(/市$/, '')) || name.includes(normalized)) {
      return {
        success: true,
        data: {
          latitude: coord.lat,
          longitude: coord.lng,
          city: name
        }
      };
    }
  }

  // 未找到，返回默认坐标（北京）
  return {
    success: true,
    data: {
      latitude: DEFAULT_COORDS.lat,
      longitude: DEFAULT_COORDS.lng,
      city: '北京（默认）'
    }
  };
}
